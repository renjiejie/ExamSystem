<!DOCTYPE HTML>
<html>
	<head>
		<title>Blank Page</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="Novus Admin Panel Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
		SmartPhone Compatible web template, free WebDesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
		<script type="application/x-javascript">
			addEventListener("load", function() {
				setTimeout(hideURLbar, 0);
			}, false);

			function hideURLbar() {
				window.scrollTo(0, 1);
			}
		</script>
		<!-- Bootstrap Core CSS -->
		<link href="/exam/css/bootstrap.css" rel='stylesheet' type='text/css' />
		<!-- Custom CSS -->
		<link href="/exam/css/style.css" rel='stylesheet' type='text/css' />
		<!-- font CSS -->
		<!-- font-awesome icons -->
		<link href="/exam/css/font-awesome.css" rel="stylesheet">
		<!-- //font-awesome icons -->
		<!-- js-->
		<script src="/exam/js/jquery-1.11.1.min.js"></script>
		<script src="/exam/js/modernizr.custom.js"></script>
		<!--animate-->
		<link href="/exam/css/animate.css" rel="stylesheet" type="text/css" media="all">
		<script src="/exam/js/wow.min.js"></script>
		<script>
			new WOW().init();
			</script>
		<!--//end-animate-->
		<!-- Metis Menu -->
		<script src="/exam/js/metisMenu.min.js"></script>
		<script src="/exam/js/custom.js"></script>
		<link href="/exam/css/custom.css" rel="stylesheet">
		<!--//Metis Menu -->

		<style>
			.middle{
	 margin:0 auto; 
	 width:350px; 
	 height:100px; 
	 } //border:1px solid #F00
</style>
	</head>
	<body class="cbp-spmenu-push">
		<div class="main-content">
			<!--left-fixed -navigation-->
			<div class=" sidebar" role="navigation">
				<div class="navbar-collapse">
					<nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" id="cbp-spmenu-s1">
						<ul class="nav" id="side-menu">

							<li>
								<a href="/exam/admin.html"><i class="fa fa-home nav_icon"></i>管理员主页</a>
							</li>
							<li>
								<a href="/exam/adminmanage2.html"><i class="fa fa-user nav_icon"></i>用户管理</a>
							</li>
							<li>
								<a href="/exam/adminCourse.html"><i class="fa fa-book nav_icon"></i>安排课程</a>
							</li>
							<li>
								<a href="/exam/adminexam2.html"><i class="fa fa-file nav_icon"></i>安排考试</a>
							</li>
							<li>
								<a href="/exam/adminExamAnalyse.html"><i class="fa fa-list nav_icon"></i>成绩分析</a>
							</li>
						</ul>
						<div class="clearfix"> </div>
						<!-- //sidebar-collapse -->
					</nav>
				</div>
			</div>
			<!--left-fixed -navigation-->
			<!-- header-starts -->
			<div class="sticky-header header-section ">
				<div class="header-left">
					<!--toggle button start-->
					<button id="showLeftPush"><i class="fa fa-bars"></i></button>
					<!--toggle button end-->
					<!--logo -->
					<div class="logo">
						<a href="/exam/admin.html">
							<h1>管理员</h1>
							<span>学生考试系统</span>
						</a>
					</div>
					<!--//logo-->
					<!--search-box-->
					<!--//end-search-box-->
					<div class="clearfix"> </div>
				</div>
				<div class="header-right">
					<div class="profile_details_left">
						<!--notifications of menu start -->
						<ul class="nofitications-dropdown">

							<li class="dropdown head-dpdn">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-bell"></i><span
									 class="badge blue1">1</span></a>
								<ul class="dropdown-menu">
									<li>
										<div class="notification_header">
											<h3>有1次考试正在进行</h3>
										</div>
									</li>
								</ul>
							</li>
						</ul>
						<div class="clearfix"> </div>
					</div>
					<!--notification menu end -->
					<div class="profile_details">
						<ul>
							<li class="dropdown profile_details_drop">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
									<div class="profile_img">
										<div class="user-name">
											<p>Wikolia</p>
											<span>Administrator</span>
										</div>
										<i class="fa fa-angle-down lnr"></i>
										<i class="fa fa-angle-up lnr"></i>
										<div class="clearfix"></div>
									</div>
								</a>
								<ul class="dropdown-menu drp-mnu">
									<li> <a href="/exam/admin.html"><i class="fa fa-user"></i> Profile</a> </li>
									<li> <a href="/exam/login1.html"><i class="fa fa-sign-out"></i> Logout</a> </li>
								</ul>
							</li>
						</ul>
					</div>
					<div class="clearfix"> </div>
				</div>
				<div class="clearfix"> </div>
			</div>
			<!-- //header-ends -->
			<!-- main content start-->
			<div id="page-wrapper">
				<div class="main-page">
					<div class="blank-page widget-shadow scroll" id="style-2 div1">

						<!-- 搜索框 -->
						<div class="middle">
							<form class="form-inline">
								<div class="form-group">
									<div class="input-group">
										<span class="input-group-addon" style="width:50px">
											<span class="glyphicon glyphicon-book"></span>
										</span>
										<input type="text" class="form-control" placeholder="CourseName" aria-describedby="basic-addon1" id="username"
										 name="username" style="width:200px">
										<button type="button" class="btn btn-default">
											<span class="glyphicon glyphicon-search"></span>
										</button>
										<button type="button" class="btn btn-default" data-toggle="modal" data-target="#addModal">
											<span class="glyphicon glyphicon-plus"></span>
										</button>
									</div>
								</div>
							</form>
						</div>
						<!-- 搜索框 -->

						<!-- 添加模态框 -->
						<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel">添加考试</h4>
									</div>
									<div class="modal-body">
										<form id="addForm">
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-book"></span>
													</span>
													<input type="text" class="form-control" placeholder="Exam Name" aria-describedby="basic-addon1" id="addExamName">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-book"></span>
													</span>
													<input type="text" class="form-control" placeholder="Course Name" aria-describedby="basic-addon1" id="addCourseName">
												</div>
											</div>
											<div class="form-group">
												<div class="inbox-row widget-shadow" id="accordion" role="tablist" aria-multiselectable="true">
													<div class="mail mail-name">
													</div>
													<a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false"
													 aria-controls="collapseTwo" class="collapsed">
														<div class="mail">
															<p>考试试卷</p>
														</div>
													</a>
													<div class="clearfix"> </div>
													<div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne"
													 aria-expanded="false" style="height: 0px;">
														<div class="mail-body">
															<div class="checkbox">
																<input type="checkbox" name="paper" value="A">A卷
															</div>
															<div class="checkbox">
																<input type="checkbox" name="paper" value="B">B卷
															</div>
															<div class="checkbox">
																<input type="checkbox" name="paper" value="C">C卷
															</div>
															<div class="checkbox">
																<input type="checkbox" name="paper" value="D">D卷
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-file"></span>
													</span>
													<input type="text" class="form-control" placeholder="Exam Description" aria-describedby="basic-addon1" id="addDescription">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
													<input type="text" class="form-control" placeholder="Start Time" aria-describedby="basic-addon1" id="addStartTime">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-time"></span>
													</span>
													<input type="text" class="form-control" placeholder="Duration" aria-describedby="basic-addon1" id="addDuration">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
													<input type="text" class="form-control" placeholder="End Time" aria-describedby="basic-addon1" id="addEndTime">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-home"></span>
													</span>
													<input type="text" class="form-control" placeholder="Place" aria-describedby="basic-addon1" id="addPlace">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-user"></span>
													</span>
													<input type="text" class="form-control" placeholder="Supervisors" aria-describedby="basic-addon1" id="addSupervisor">
												</div>
											</div>
										</form>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
										<button type="button" class="btn btn-primary" id="addButton">添加考试</button>
									</div>
								</div><!-- /.modal-content -->
							</div><!-- /.modal -->
						</div>
						<!-- 添加模态框 -->

						<!-- 详细信息模态框 -->
						<div class="modal fade" id="moreModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel">考试详情</h4>
									</div>
									<div class="modal-body">
										<table class="table">
											<tbody>
												<tr class="active">
													<td>考试</td>
													<td id="moreExamName"></td>
												</tr>
												<tr>
													<td>课程</td>
													<td id="moreExamCourse"></td>
												</tr>
												<tr>
													<td>考试开始时间</td>
													<td id="moreExamStart"></td>
												</tr>
												<tr class="info">
													<td>考试时长</td>
													<td id="moreExamDuration"></td>
												</tr>
												<tr>
													<td>考试结束时间</td>
													<td id="moreExamEnd"></td>
												</tr>
												<tr class="danger">
													<td>考试试卷</td>
													<td id="moreExamPaper"></td>
												</tr>
												<tr>
													<td>考试描述</td>
													<td id="moreExamDescription"></td>
												</tr>
												<tr class="warning">
													<td>考场</td>
													<td id="moreExamPlace"></td>
												</tr>
												<tr>
													<td>监考教师</td>
													<td id="moreExamSupervisor"></td>
												</tr>
											</tbody>
										</table>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
									</div>
								</div><!-- /.modal-content -->
							</div><!-- /.modal -->
						</div>
						<!-- 详细信息模态框 -->

						<!-- 修改信息模态框 -->
						<div class="modal fade" id="changeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel">修改考试</h4>
									</div>
									<div class="modal-body">
										<form>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-book"></span>
													</span>
													<input type="text" class="form-control" placeholder="examID" aria-describedby="basic-addon1" id="paperid"
													 name="username">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-book"></span>
													</span>
													<input type="text" class="form-control" placeholder="CourseID" aria-describedby="basic-addon1" id="courseid"
													 name="username">
												</div>
											</div>
											<div style="padding-bottom: 20px;">
												<div class="inbox-row widget-shadow" id="accordion" role="tablist" aria-multiselectable="true">
													<div class="mail mail-name">
													</div>
													<a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false"
													 aria-controls="collapseOne" class="collapsed">
														<div class="mail">
															<p>考试试卷</p>
														</div>
													</a>
													<div class="clearfix"> </div>
													<div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne"
													 aria-expanded="false" style="height: 0px;">
														<div class="mail-body">
															<div class="checkbox">
																<input type="checkbox" name="multianswer3">A卷
															</div>
															<div class="checkbox">
																<input type="checkbox" name="multianswer3">B卷
															</div>
															<div class="checkbox">
																<input type="checkbox" name="multianswer3">C卷
															</div>
															<div class="checkbox">
																<input type="checkbox" name="multianswer3">D卷
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-file"></span>
													</span>
													<input type="text" class="form-control" placeholder="Exam Description" aria-describedby="basic-addon1" id="paperid"
													 name="username">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
													<input type="text" class="form-control" placeholder="StartTime" aria-describedby="basic-addon1" id="starttime"
													 name="starttime">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-time"></span>
													</span>
													<input type="text" class="form-control" placeholder="Duaration" aria-describedby="basic-addon1" id="duaration"
													 name="duaration">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
													<input type="text" class="form-control" placeholder="EndTime" aria-describedby="basic-addon1" id="endtime"
													 name="endtime">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-home"></span>
													</span>
													<input type="text" class="form-control" placeholder="Place" aria-describedby="basic-addon1" id="place"
													 name="place">
												</div>
											</div>

											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-user"></span>
													</span>
													<input type="text" class="form-control" placeholder="Supervisors" aria-describedby="basic-addon1" id="supervisor"
													 name="supervisor">
												</div>
											</div>

										</form>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
										<button type="button" class="btn btn-primary">修改完毕</button>
									</div>
								</div><!-- /.modal-content -->
							</div><!-- /.modal -->
						</div>
						<!-- 修改信息模态框 -->

						<!-- 列表 -->
						<div style="position:relative; height:600px; overflow-y:auto">
							<table class="table table-striped">
								<thead>
									<tr>
										<th>课程</th>
										<th>考试</th>
										<th>状态</th>
										<th>详情</th>
										<th>修改</th>
										<th>删除</th>
									</tr>
								</thead>
								<tbody>
									<tr id="first">
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			<!--footer-->
			<div class="footer">
				<p>学生考试系统</p>
			</div>
			<!--//footer-->
		</div>
		<!-- Classie -->
		<script src="/exam/js/classie.js"></script>
		<script>
			var menuLeft = document.getElementById('cbp-spmenu-s1'),
				showLeftPush = document.getElementById('showLeftPush'),
				body = document.body;

			showLeftPush.onclick = function() {
				classie.toggle(this, 'active');
				classie.toggle(body, 'cbp-spmenu-push-toright');
				classie.toggle(menuLeft, 'cbp-spmenu-open');
				disableOther('showLeftPush');
			};

			function disableOther(button) {
				if (button !== 'showLeftPush') {
					classie.toggle(showLeftPush, 'disabled');
				}
			}
		</script>
		<!--scrolling js-->
		<script src="/exam/js/jquery.nicescroll.js"></script>
		<script src="/exam/js/scripts.js"></script>
		<!--//scrolling js-->
		<!-- Bootstrap Core JavaScript -->
		<script src="/exam/js/bootstrap.js"> </script>

		<script>
			$("#addButton").click(function() {
				var exam = $("#addExamName").val();
				var course = $("#addCourseName").val();
				var description = $("#addDescription").val();
				var start = $("#addStartTime").val();
				var duration = $("#addDuration").val();
				var end = $("#addEndTime").val();
				var place = $("#addPlace").val();
				var supervisor = $("#addSupervisor").val();
				var checks = $("input[name = paper]");
				var selected = false;
				var paper = "";
				//检查checkbox至少选中一个
				for (var i = 0; i < checks.length; i++) {
					if (checks[i].checked) {
						selected = true;
						paper += checks[i].value + ",";
					}
				}
				if (!selected) {
					alert("未选择考试试卷");
					return false;
				}
				//检查输入不为空
				$("#addForm input").each(function(index, element) {
					if (element.value == null || element.value == "") {
						alert("请输入所有信息");
						return false;
					}
				});
				//判断时间是否有效
				var pattern =
					/^\d{4}[-]([0][1-9]|(1[0-2]))[-]([1-9]|([012]\d)|(3[01]))([ \t\n\x0B\f\r])(([0-1][0-9])|([2][0-4]))([:])(([0-5][0-9]|[6][0]))([:])((([0-5][0-9]|[6][0])))$/;
				var re = new RegExp(pattern);
				if (!re.test(start)) {
					alert("开始时间不符合格式\n正确格式：yyyy-mm-dd hh:mm:ss");
					return false;
				} else if (!re.test(end)) {
					alert("结束时间不符合格式\n正确格式：yyyy-mm-dd hh:mm:ss");
					return false;
				} else {
					var date1 = new Date(Date.parse(start.replace(/-/g, "/")));
					var date2 = new Date(Date.parse(end.replace(/-/g, "/")));
					var date = new Date();
					if (date >= date1) {
						alert("开始时间必须大于系统时间");
						return false;
					}
					if (date1 >= date2) {
						alert("开始时间必须小于结束时间");
						return false;
					} else {
						var pattern1 = /[1-9]\d*/;
						var re1 = new RegExp(pattern1);
						if (!re1.test(duration)) {
							alert("考试时长必须是正整数");
							return false;
						} else {
							if ((date2.getTime() - date1.getTime()) < (duration * 60 * 1000)) {
								alert("考试时间安排错误，检查开始时间，时长，结束时间");
								return false;
							}
						}
					}
				}
				var addURL = "/exam/admin/addExam/" + exam + "/" + course + "/" + description + "/" + start + "/" + duration +
					"/" + end + "/" +
					place + "/" + supervisor + "/" + paper;
				$.ajax({
					url: addURL,
					type: "GET",
					dataType: "text",
					contentType: "application/json;charset=UTF-8",
					success: function(str) {
						alert(str);
						$("#addModal").modal("hide");
						$("#addModal").on("hidden.bs.modal", function() {
							document.getElementById("addForm").reset();
						});
					},
					error: function() {

					}
				});
			});

			$("#moreModal").on("show.bs.modal", function(event) {
				var button = $(event.relatedTarget);
				var exam = button.data("whatever");
				var moreURL = "/exam/admin/queryExam/" + exam;
				$.ajax({
					url: moreURL,
					type: "GET",
					dataType: "json",
					success: function(str) {
						$("#moreExamName").html(str[0].id);
						$("#moreExamCourse").html(str[0].courseId);
						$("#moreExamStart").html(str[0].begintime);
						$("#moreExamDuration").html(str[0].period + "分钟");
						$("#moreExamEnd").html(str[0].endtime);
						$("#moreExamPaper").html(str[0].ids);
						$("#moreExamDescription").html(str[0].discript);
						$("#moreExamPlace").html(str[0].place);
						$("#moreExamSupervisor").html(str[0].supervisor);
					},
					error: function() {}
				});
			});

			$(document).ready(function() {
				queryAll();
			});

			function auto_list(str) {
				//清空id=first的所有兄弟节点
				$("#first").siblings().remove();
				var res = "";
				$(str)
					.each(
						function(index, e) {
							res = res + "<tr>";
							res = res + "<td>" + e.courseId + "</td>";
							res = res + "<td>" + e.id + "</td>";
							var start = new Date(Date.parse((e.begintime).replace(/-/g, "/")));
							var end = new Date(Date.parse((e.endtime).replace(/-/g, "/")));
							var date = new Date();
							if (start < date) {
								res = res + "<td>" + "未开始" + "</td>";
							} else if (end > date) {
								res = res + "<td>" + "已结束" + "</td>";
							} else {
								res = res + "<td>" + "正在进行" + "</td>";
							}
							res = res + "<td>";
							res = res +
								'<button type="button" class="btn btn-default" data-toggle="modal" data-target="#moreModal" data-whatever="' +
								e.id + '"><span class="glyphicon glyphicon-list-alt"></span></button>';
							res = res + "</td>";
							res = res + "<td>";
							res = res +
								'<button type="button" class="btn btn-default" data-toggle="modal" data-target="#changeModal" data-whatever="' +
								e.id + '"><span class="glyphicon glyphicon-pencil"></span></button>';
							res = res + "</td>";
							res = res + "<td>";
							res = res +
								'<button type="button" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span></button>';
							res = res + "</td>";
							res = res + "</tr>";
						});
				var app = $(res);
				$("#first").after(app);
			}

			function queryAll() {
				var queryURL = "/exam/admin/queryExam/All";
				$.ajax({
					url: queryURL,
					type: "GET",
					dataType: "json",
					success: function(str) {
						auto_list(str);
					},
					error: function() {}
				});
			}
		</script>
	</body>
</html>
