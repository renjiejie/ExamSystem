<!DOCTYPE HTML>
<html>
	<head>
		<title>Blank Page</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="Novus Admin Panel Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
		SmartPhone Compatible web template, free WebDesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
		<script type="application/x-javascript">
			addEventListener("load", function() {
				setTimeout(hideURLbar, 0);
			}, false);

			function hideURLbar() {
				window.scrollTo(0, 1);
			}
		</script>
		<!-- Bootstrap Core CSS -->
		<link href="/exam/css/bootstrap.css" rel='stylesheet' type='text/css' />
		<!-- Custom CSS -->
		<link href="/exam/css/style.css" rel='stylesheet' type='text/css' />
		<!-- font CSS -->
		<!-- font-awesome icons -->
		<link href="/exam/css/font-awesome.css" rel="stylesheet">
		<!-- //font-awesome icons -->
		<!-- js-->
		<script src="/exam/js/jquery-1.11.1.min.js"></script>
		<script src="/exam/js/modernizr.custom.js"></script>
		<!--animate-->
		<link href="/exam/css/animate.css" rel="stylesheet" type="text/css" media="all">
		<script src="/exam/js/wow.min.js"></script>
		<script>
			new WOW().init();
			</script>
		<!--//end-animate-->
		<!-- Metis Menu -->
		<script src="/exam/js/metisMenu.min.js"></script>
		<script src="/exam/js/custom.js"></script>
		<link href="/exam/css/custom.css" rel="stylesheet">
		<!--//Metis Menu -->

		<style>
			.middle{
	 margin:0 auto; 
	 width:410px; 
	 height:100px; 
	 } //border:1px solid #F00
</style>
	</head>
	<body class="cbp-spmenu-push">
		<div class="main-content">
			<!--left-fixed -navigation-->
			<div class=" sidebar" role="navigation">
				<div class="navbar-collapse">
					<nav class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" id="cbp-spmenu-s1">
						<ul class="nav" id="side-menu">

							<li>
								<a href="/exam/admin.html"><i class="fa fa-home nav_icon"></i>管理员主页</a>
							</li>
							<li>
								<a href="/exam/adminmanage2.html"><i class="fa fa-user nav_icon"></i>用户管理</a>
							</li>
							<li>
								<a href="/exam/adminCourse.html"><i class="fa fa-book nav_icon"></i>安排课程</a>
							</li>
							<li>
								<a href="/exam/adminexam2.html"><i class="fa fa-file nav_icon"></i>安排考试</a>
							</li>
							<li>
								<a href="/exam/adminExamAnalyse.html"><i class="fa fa-list nav_icon"></i>成绩分析</a>
							</li>
						</ul>
						<div class="clearfix"> </div>
						<!-- //sidebar-collapse -->
					</nav>
				</div>
			</div>
			<!--left-fixed -navigation-->
			<!-- header-starts -->
			<div class="sticky-header header-section ">
				<div class="header-left">
					<!--toggle button start-->
					<button id="showLeftPush"><i class="fa fa-bars"></i></button>
					<!--toggle button end-->
					<!--logo -->
					<div class="logo">
						<a href="/exam/admin.html">
							<h1>管理员</h1>
							<span>学生考试系统</span>
						</a>
					</div>
					<!--//logo-->
					<!--search-box-->
					<!--//end-search-box-->
					<div class="clearfix"> </div>
				</div>
				<div class="header-right">
					<div class="profile_details_left">
						<!--notifications of menu start -->
						<ul class="nofitications-dropdown">

							<li class="dropdown head-dpdn">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-bell"></i><span
									 class="badge blue1">1</span></a>
								<ul class="dropdown-menu">
									<li>
										<div class="notification_header">
											<h3>有1次考试正在进行</h3>
										</div>
									</li>
								</ul>
							</li>
						</ul>
						<div class="clearfix"> </div>
					</div>
					<!--notification menu end -->
					<div class="profile_details">
						<ul>
							<li class="dropdown profile_details_drop">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
									<div class="profile_img">
										<div class="user-name">
											<p>Wikolia</p>
											<span>Administrator</span>
										</div>
										<i class="fa fa-angle-down lnr"></i>
										<i class="fa fa-angle-up lnr"></i>
										<div class="clearfix"></div>
									</div>
								</a>
								<ul class="dropdown-menu drp-mnu">
									<li> <a href="/exam/admin.html"><i class="fa fa-user"></i> Profile</a> </li>
									<li> <a href="/exam/login1.html"><i class="fa fa-sign-out"></i> Logout</a> </li>
								</ul>
							</li>
						</ul>
					</div>
					<div class="clearfix"> </div>
				</div>
				<div class="clearfix"> </div>
			</div>
			<!-- //header-ends -->
			<!-- main content start-->
			<div id="page-wrapper">
				<div class="main-page">
					<div class="blank-page widget-shadow scroll" id="style-2 div1">

						<!-- 搜索框 -->
						<div class="middle">
							<form class="form-inline" id="searchForm">
								<div class="form-group">
									<div class="input-group">
										<select class="form-control" style="width:100px" id="searchType">
											<option value="0">全部</option>
											<option value="1">进行中</option>
											<option value="2">已结束</option>
											<option value="3">未开始</option>
										</select>
										<input type="text" class="form-control" placeholder="Exam Name" aria-describedby="basic-addon1" id="searchExam"
										 style="width:200px">
										<button type="button" class="btn btn-default" id="searchButton">
											<span class="glyphicon glyphicon-search"></span>
										</button>
										<button type="button" class="btn btn-default" data-toggle="modal" data-target="#addModal">
											<span class="glyphicon glyphicon-plus"></span>
										</button>
									</div>
								</div>
							</form>
						</div>
						<!-- 搜索框 -->

						<!-- 添加模态框 -->
						<div class="modal fade bs-example-modal-sm" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
						 aria-hidden="true">
							<div class="modal-dialog modal-sm">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel">添加考试</h4>
									</div>
									<div class="modal-body">
										<form id="addForm">
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-book"></span>
													</span>
													<input type="text" class="form-control" placeholder="Exam Name" aria-describedby="basic-addon1" id="addExamName">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-book"></span>
													</span>
													<input type="text" class="form-control" placeholder="Course Name" aria-describedby="basic-addon1" id="addCourseName">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-file"></span>
													</span>
													<input type="text" class="form-control" placeholder="Exam Description" aria-describedby="basic-addon1" id="addDescription">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
													<input type="text" class="form-control" placeholder="Start Time" aria-describedby="basic-addon1" id="addStartTime">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-time"></span>
													</span>
													<input type="text" class="form-control" placeholder="Duration" aria-describedby="basic-addon1" id="addDuration">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
													<input type="text" class="form-control" placeholder="End Time" aria-describedby="basic-addon1" id="addEndTime">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-home"></span>
													</span>
													<input type="text" class="form-control" placeholder="Place" aria-describedby="basic-addon1" id="addPlace">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-user"></span>
													</span>
													<input type="text" class="form-control" placeholder="Supervisors" aria-describedby="basic-addon1" id="addSupervisor">
												</div>
											</div>
											<div class="form-group">
												<table class="table table-striped">
													<thead>
														<tr>
															<th>选用</th>
															<th>试卷</th>
														</tr>
													</thead>
													<tbody>
														<tr id="firstCheck">
														</tr>
													</tbody>
												</table>
											</div>
										</form>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
										<button type="button" class="btn btn-primary" id="addButton">添加考试</button>
									</div>
								</div><!-- /.modal-content -->
							</div><!-- /.modal -->
						</div>
						<!-- 添加模态框 -->

						<!-- 详细信息模态框 -->
						<div class="modal fade" id="moreModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel">考试详情</h4>
									</div>
									<div class="modal-body">
										<table class="table table-striped">
											<tbody>
												<tr>
													<td>考试</td>
													<td id="moreExamName"></td>
												</tr>
												<tr>
													<td>课程</td>
													<td id="moreExamCourse"></td>
												</tr>
												<tr>
													<td>考试开始时间</td>
													<td id="moreExamStart"></td>
												</tr>
												<tr>
													<td>考试时长</td>
													<td id="moreExamDuration"></td>
												</tr>
												<tr>
													<td>考试结束时间</td>
													<td id="moreExamEnd"></td>
												</tr>
												<tr>
													<td>考试试卷</td>
													<td id="moreExamPaper"></td>
												</tr>
												<tr>
													<td>考试描述</td>
													<td id="moreExamDescription"></td>
												</tr>
												<tr>
													<td>考场</td>
													<td id="moreExamPlace"></td>
												</tr>
												<tr>
													<td>监考教师</td>
													<td id="moreExamSupervisor"></td>
												</tr>
											</tbody>
										</table>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
									</div>
								</div><!-- /.modal-content -->
							</div><!-- /.modal -->
						</div>
						<!-- 详细信息模态框 -->

						<!-- 修改信息模态框 -->
						<div class="modal fade bs-example-modal-sm" id="changeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-sm">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel">修改考试</h4>
									</div>
									<div class="modal-body">
										<form id="changeForm">
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-book"></span>
													</span>
													<input type="text" class="form-control" placeholder="Exam Name" aria-describedby="basic-addon1" id="changeExamName"
													 disabled>
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-book"></span>
													</span>
													<input type="text" class="form-control" placeholder="Course Name" aria-describedby="basic-addon1" id="changeExamCourse"
													 disabled>
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-file"></span>
													</span>
													<input type="text" class="form-control" placeholder="Exam Description" aria-describedby="basic-addon1" id="changeExamDescription">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
													<input type="text" class="form-control" placeholder="Start Time" aria-describedby="basic-addon1" id="changeStartTime">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-time"></span>
													</span>
													<input type="text" class="form-control" placeholder="Duration" aria-describedby="basic-addon1" id="changeDuration">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-calendar"></span>
													</span>
													<input type="text" class="form-control" placeholder="End Time" aria-describedby="basic-addon1" id="changeEndTime">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-home"></span>
													</span>
													<input type="text" class="form-control" placeholder="Place" aria-describedby="basic-addon1" id="changePlace">
												</div>
											</div>
											<div class="form-group">
												<div class="input-group">
													<span class="input-group-addon">
														<span class="glyphicon glyphicon-user"></span>
													</span>
													<input type="text" class="form-control" placeholder="Supervisors" aria-describedby="basic-addon1" id="changeSupervisor">
												</div>
											</div>

											<div class="form-group">
												<table class="table table-striped">
													<thead>
														<tr>
															<th>选用</th>
															<th>试卷</th>
														</tr>
													</thead>
													<tbody>
														<tr id="firstChangeCheck">
														</tr>
													</tbody>
												</table>
											</div>
										</form>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
										<button type="button" class="btn btn-primary" id="changeButton">提交</button>
									</div>
								</div><!-- /.modal-content -->
							</div><!-- /.modal -->
						</div>
						<!-- 修改信息模态框 -->

						<!-- 删除模态框 -->
						<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-sm">
								<div class="modal-content">
									<div class="modal-header">
										<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
										<h4 class="modal-title" id="myModalLabel">删除课程</h4>
									</div>
									<div class="modal-body">
										<label class="control-label">确认删除:</label>
										<p id="deleteExam"></p>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
										<button type="button" class="btn btn-primary" id="deleteButton">提交</button>
									</div>
								</div>
								<!-- /.modal-content -->
							</div>
							<!-- /.modal -->
						</div>
						<!-- 删除模态框 -->

						<!-- 列表 -->
						<div style="position:relative; height:600px; overflow-y:auto">
							<table class="table table-striped">
								<thead>
									<tr>
										<th>课程</th>
										<th>考试</th>
										<th>状态</th>
										<th>详情</th>
										<th>修改</th>
										<th>删除</th>
									</tr>
								</thead>
								<tbody>
									<tr id="first">
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			<!--footer-->
			<div class="footer">
				<p>学生考试系统</p>
			</div>
			<!--//footer-->
		</div>
		<!-- Classie -->
		<script src="/exam/js/classie.js"></script>
		<script>
			var menuLeft = document.getElementById('cbp-spmenu-s1'),
				showLeftPush = document.getElementById('showLeftPush'),
				body = document.body;

			showLeftPush.onclick = function() {
				classie.toggle(this, 'active');
				classie.toggle(body, 'cbp-spmenu-push-toright');
				classie.toggle(menuLeft, 'cbp-spmenu-open');
				disableOther('showLeftPush');
			};

			function disableOther(button) {
				if (button !== 'showLeftPush') {
					classie.toggle(showLeftPush, 'disabled');
				}
			}
		</script>
		<!--scrolling js-->
		<script src="/exam/js/jquery.nicescroll.js"></script>
		<script src="/exam/js/scripts.js"></script>
		<!--//scrolling js-->
		<!-- Bootstrap Core JavaScript -->
		<script src="/exam/js/bootstrap.js"> </script>

		<script>
			$("#addButton").click(function() {
				var exam = $("#addExamName").val();
				var course = $("#addCourseName").val();
				var description = $("#addDescription").val();
				var start = $("#addStartTime").val();
				var duration = $("#addDuration").val();
				var end = $("#addEndTime").val();
				var place = $("#addPlace").val();
				var supervisor = $("#addSupervisor").val();
				var checks = $("input[name = paper]");
				var selected = false;
				var paper = "";
				//检查checkbox至少选中一个
				for (var i = 0; i < checks.length; i++) {
					if (checks[i].checked) {
						selected = true;
						paper += checks[i].value + ",";
					}
				}
				if (!selected) {
					alert("未选择考试试卷");
					return false;
				}
				//检查输入不为空
				$("#addForm input").each(function(index, element) {
					if (element.value == null || element.value == "") {
						alert("请输入所有信息");
						return false;
					}
				});
				//判断时间是否有效
				var pattern =
					/^\d{4}[-]([0][1-9]|(1[0-2]))[-]([1-9]|([012]\d)|(3[01]))([ \t\n\x0B\f\r])(([0-1][0-9])|([2][0-4]))([:])(([0-5][0-9]|[6][0]))([:])((([0-5][0-9]|[6][0])))$/;
				var re = new RegExp(pattern);
				if (!re.test(start)) {
					alert("开始时间不符合格式\n正确格式：yyyy-mm-dd hh:mm:ss");
					return false;
				} else if (!re.test(end)) {
					alert("结束时间不符合格式\n正确格式：yyyy-mm-dd hh:mm:ss");
					return false;
				} else {
					var date1 = new Date(Date.parse(start.replace(/-/g, "/")));
					var date2 = new Date(Date.parse(end.replace(/-/g, "/")));
					var date = new Date();
					if (date >= date1) {
						alert("开始时间必须大于系统时间");
						return false;
					}
					if (date1 >= date2) {
						alert("开始时间必须小于结束时间");
						return false;
					} else {
						var pattern1 = /[1-9]\d*/;
						var re1 = new RegExp(pattern1);
						if (!re1.test(duration)) {
							alert("考试时长必须是正整数");
							return false;
						} else {
							if ((date2.getTime() - date1.getTime()) < (duration * 60 * 1000)) {
								alert("考试时间安排错误，检查开始时间，时长，结束时间");
								return false;
							}
						}
					}
				}
				var addURL = "/exam/admin/addExam/" + exam + "/" + course + "/" + description + "/" + start + "/" + duration +
					"/" + end + "/" +
					place + "/" + supervisor + "/" + paper;
				$.ajax({
					url: addURL,
					type: "GET",
					dataType: "text",
					contentType: "application/json;charset=UTF-8",
					success: function(str) {
						alert(str);
						$("#addModal").modal("hide");
						queryAll();
					},
					error: function() {

					}
				});
			});

			$("#addModal").on("hidden.bs.modal", function() {
				document.getElementById("addForm").reset();
			});

			$("#moreModal").on("show.bs.modal", function(event) {
				var button = $(event.relatedTarget);
				var exam = button.data("whatever");
				var moreURL = "/exam/admin/queryExam/" + exam;
				$.ajax({
					url: moreURL,
					type: "GET",
					dataType: "json",
					success: function(str) {
						$("#moreExamName").html(str[0].id);
						$("#moreExamCourse").html(str[0].courseId);
						$("#moreExamStart").html(str[0].begintime);
						$("#moreExamDuration").html(str[0].period + "分钟");
						$("#moreExamEnd").html(str[0].endtime);
						$("#moreExamPaper").html(str[0].ids);
						$("#moreExamDescription").html(str[0].discript);
						$("#moreExamPlace").html(str[0].place);
						$("#moreExamSupervisor").html(str[0].supervisor);
					},
					error: function() {}
				});
			});

			$("#deleteModal").on("show.bs.modal", function(event) {
				var button = $(event.relatedTarget);
				var exam = button.data("whatever");
				$("#deleteExam").html(exam);
			});

			$("#deleteModal").on("shown.bs.modal", function(event) {
				var button = $(event.relatedTarget);
				var exam = button.data("whatever");
				var queryURL = "/exam/admin/queryExam/" + exam;
				$.ajax({
					url: queryURL,
					type: "GET",
					dataType: "json",
					success: function(str) {
						var start = new Date(Date.parse((str[0].begintime).replace(/-/g, "/")));
						var end = new Date(Date.parse((str[0].endtime).replace(/-/g, "/")));
						var date = new Date();
						if (start > date) {} else if (end < date) {
							alert("考试已结束无法删除");
							$("#deleteModal").modal("hide");
						} else {
							alert("考试正在进行无法删除");
							$("#deleteModal").modal("hide");
						}
					},
					error: function() {}
				});
			});

			$("#deleteButton").click(function() {
				var exam = $("#deleteExam").text();
				var deleteURL = "/exam/admin/deleteExam/" + exam;
				$.ajax({
					url: deleteURL,
					type: "GET",
					dataType: "text",
					contentType: "application/json;charset=UTF-8",
					success: function(str) {
						alert(str);
						$("#deleteModal").modal("hide");
						queryAll();
					},
					error: function() {

					}
				});

			});

			$("#searchButton").click(function() {
				var exam = $("#searchExam").val();
				var queryURL;
				if (exam == null || exam == "") {
					queryURL = "/exam/admin/queryExam/All";
				} else {
					queryURL = "/exam/admin/queryExam/" + exam;
				}
				$.ajax({
					url: queryURL,
					type: "GET",
					dataType: "json",
					success: function(str) {
						auto_list(str);
						//document.getElementById("searchExam").value = "";
					},
					error: function() {}
				});
			});

			$("#changeModal").on("show.bs.modal", function(event) {
				var button = $(event.relatedTarget);
				var exam = button.data("whatever");
				document.getElementById("changeExamName").value = exam;
				var queryURL = "/exam/admin/queryExam/" + exam;
				$.ajax({
					url: queryURL,
					type: "GET",
					dataType: "json",
					success: function(str) {
						document.getElementById("changeExamCourse").value = str[0].courseId;
						document.getElementById("changeExamDescription").value = str[0].discript;
						document.getElementById("changeStartTime").value = str[0].begintime;
						document.getElementById("changeDuration").value = str[0].period;
						document.getElementById("changeEndTime").value = str[0].endtime;
						document.getElementById("changePlace").value = str[0].place;
						document.getElementById("changeSupervisor").value = str[0].supervisor;
						var course = $("#changeExamCourse").val();
						var checks = (str[0].ids).split(",");
						var queryURL = "/exam/admin/queryPaperByCourse/" + course;
						$.ajax({
							url: queryURL,
							type: "GET",
							dataType: "json",
							contentType: "application/json;charset=UTF-8",
							success: function(str) {
								$("#firstChangeCheck").siblings().remove();
								var res = "";
								$(str).each(function(index, e) {
									var flag = false;
									res = res + "<tr><td>";
									for (var i = 0; i < checks.length; i++) {
										if (checks[i] == e) {
											flag = true;
											break;
										}
									}
									if (flag) {
										res = res + "<input type='checkbox' name='changePaper' value='" + e + "' checked='checked'>";
									} else {
										res = res + "<input type='checkbox' name='changePaper' value='" + e + "'>";
									}
									res = res + "</td><td>"
									res = res + e;
									res = res + "</td></tr>";
								});
								var app = $(res);
								$("#firstChangeCheck").after(app);
							},
							error: function() {

							}

						});
					},
					error: function() {}
				});
			});

			$("#changeModal").on("shown.bs.modal", function(event) {
				var start = new Date(Date.parse(($("#changeStartTime").val()).replace(/-/g, "/")));
				var end = new Date(Date.parse(($("#changeEndTime").val()).replace(/-/g, "/")));
				var date = new Date();
				if (start > date) {} else if (end < date) {
					alert("考试已结束无法修改");
					$("#changeModal").modal("hide");
				} else {
					alert("考试正在进行无法修改");
					$("#changeModal").modal("hide");
				}
			});

			$("#changeModal").on("hidden.bs.modal", function() {
				document.getElementById("changeForm").reset();
			});

			$("#changeButton").click(function() {
				var exam = $("#changeExamName").val();
				var course = $("#changeExamCourse").val();
				var description = $("#changeExamDescription").val();
				var start = $("#changeStartTime").val();
				var duration = $("#changeDuration").val();
				var end = $("#changeEndTime").val();
				var place = $("#changePlace").val();
				var supervisor = $("#changeSupervisor").val();
				var checks = $("input[name = changePaper]");
				var selected = false;
				var paper = "";
				//检查checkbox至少选中一个
				for (var i = 0; i < checks.length; i++) {
					if (checks[i].checked) {
						selected = true;
						paper += checks[i].value + ",";
					}
				}
				if (!selected) {
					alert("未选择考试试卷");
					return false;
				}
				//检查输入不为空
				$("#changeForm input").each(function(index, element) {
					if (element.value == null || element.value == "") {
						alert("请输入所有信息" + element.id);
						return false;
					}
				});
				//判断时间是否有效
				var pattern =
					/^\d{4}[-]([0][1-9]|(1[0-2]))[-]([1-9]|([012]\d)|(3[01]))([ \t\n\x0B\f\r])(([0-1][0-9])|([2][0-4]))([:])(([0-5][0-9]|[6][0]))([:])((([0-5][0-9]|[6][0])))$/;
				var re = new RegExp(pattern);
				if (!re.test(start)) {
					alert("开始时间不符合格式\n正确格式：yyyy-mm-dd hh:mm:ss");
					return false;
				} else if (!re.test(end)) {
					alert("结束时间不符合格式\n正确格式：yyyy-mm-dd hh:mm:ss");
					return false;
				} else {
					var date1 = new Date(Date.parse(start.replace(/-/g, "/")));
					var date2 = new Date(Date.parse(end.replace(/-/g, "/")));
					var date = new Date();
					if (date >= date1) {
						alert("开始时间必须大于系统时间");
						return false;
					}
					if (date1 >= date2) {
						alert("开始时间必须小于结束时间");
						return false;
					} else {
						var pattern1 = /[1-9]\d*/;
						var re1 = new RegExp(pattern1);
						if (!re1.test(duration)) {
							alert("考试时长必须是正整数");
							return false;
						} else {
							if ((date2.getTime() - date1.getTime()) < (duration * 60 * 1000)) {
								alert("考试时间安排错误，检查开始时间，时长，结束时间");
								return false;
							}
						}
					}
				}
				var changeURL = "/exam/admin/updateExam/" + exam + "/" + course + "/" + description + "/" + start + "/" +
					duration +
					"/" + end + "/" +
					place + "/" + supervisor + "/" + paper;
				$.ajax({
					url: changeURL,
					type: "GET",
					dataType: "text",
					contentType: "application/json;charset=UTF-8",
					success: function(str) {
						alert(str);
						$("#changeModal").modal("hide");
						queryAll();
					},
					error: function() {

					}
				});
			});

			$("#addCourseName").change(function() {
				var course = $("#addCourseName").val();
				var queryURL = "/exam/admin/queryPaperByCourse/" + course;
				$("#firstCheck").siblings().remove();
				$.ajax({
					url: queryURL,
					type: "GET",
					dataType: "json",
					contentType: "application/json;charset=UTF-8",
					success: function(str) {
						$("#firstCheck").siblings().remove();
						var res = "";
						$(str).each(function(index, e) {
							res = res + "<tr><td>";
							res = res + "<input type='checkbox' name='paper' value='" + e + "'>";
							res = res + "</td><td>"
							res = res + e;
							res = res + "</td></tr>";
						});
						var app = $(res);
						$("#firstCheck").after(app);
					},
					error: function() {

					}

				});
			});

			$(document).ready(function() {
				queryAll();
			});

			function auto_list(str) {
				//清空id=first的所有兄弟节点
				$("#first").siblings().remove();
				var res = "";
				var type = $("#searchType").val();
				$(str)
					.each(
						function(index, e) {
							var start = new Date(Date.parse((e.begintime).replace(/-/g, "/")));
							var end = new Date(Date.parse((e.endtime).replace(/-/g, "/")));
							var date = new Date();
							if (start > date) {
								if (type != "0" && type != "3") {
									return true;
								}
								res = res + "<tr>";
								res = res + "<td>" + e.courseId + "</td>";
								res = res + "<td>" + e.id + "</td>";
								res = res + "<td>" + "未开始" + "</td>";
							} else if (end < date) {
								if (type != "0" && type != "2") {
									return true;
								}
								res = res + "<tr>";
								res = res + "<td>" + e.courseId + "</td>";
								res = res + "<td>" + e.id + "</td>";
								res = res + "<td>" + "已结束" + "</td>";
							} else {
								if (type != "0" && type != "1") {
									return true;
								}
								res = res + "<tr>";
								res = res + "<td>" + e.courseId + "</td>";
								res = res + "<td>" + e.id + "</td>";
								res = res + "<td>" + "正在进行" + "</td>";
							}
							res = res + "<td>";
							res = res +
								'<button type="button" class="btn btn-default" data-toggle="modal" data-target="#moreModal" data-whatever="' +
								e.id + '"><span class="glyphicon glyphicon-list-alt"></span></button>';
							res = res + "</td>";
							res = res + "<td>";
							res = res +
								'<button type="button" class="btn btn-default" data-toggle="modal" data-target="#changeModal" data-whatever="' +
								e.id + '"><span class="glyphicon glyphicon-pencil"></span></button>';
							res = res + "</td>";
							res = res + "<td>";
							res = res +
								'<button type="button" class="btn btn-default" data-toggle="modal" data-target="#deleteModal" data-whatever="' +
								e.id + '"><span class="glyphicon glyphicon-remove"></span></button>';
							res = res + "</td>";
							res = res + "</tr>";
						});
				var app = $(res);
				$("#first").after(app);
			}

			function queryAll() {
				var queryURL = "/exam/admin/queryExam/All";
				$.ajax({
					url: queryURL,
					type: "GET",
					dataType: "json",
					success: function(str) {
						auto_list(str);
					},
					error: function() {}
				});
			}
		</script>
	</body>
</html>
